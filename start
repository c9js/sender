#!/bin/bash
#┌───────────────────┐
#│ Список переменных │
#└───────────────────┘
SOURCE_FILE='sender.c' # Имя файла с исходным кодом (входной файл для компилятора)
OUTPUT_FILE='sender'   # Имя создаваемого бинарного файла (результат сборки)

#┌────────────────┐
#│ Список пакетов │
#└────────────────┘
PACKAGES=(
    linux-headers # Заголовки ядра для сборки C-модулей
)

#┌──────────────────────┐
#│ Устанавливает пакеты │
#└──────────────────────┘
install_packages() {
# Локальные переменные
    local pkg
    
# Проходим по списку пакетов
    for pkg in "${PACKAGES[@]}"; do
    # Устанавливаем пакет
        apk add "$pkg" > /dev/null 2>&1 || {
            echo 'Ошибка!'
            echo "Не удалось установить пакет: $pkg"
            exit 1
        }
    done
}

#┌──────────────────────┐
#│ Устанавливаем пакеты │
#└──────────────────────┘
echo '1/3 Устанавливаем пакеты...'
install_packages

#┌─────────────────┐
#│ Собираем проект │
#└─────────────────┘
echo '2/3 Собираем проект...'
gcc "$SOURCE_FILE" -O3 -Wall -Wextra -Werror -pedantic -flto -o "$OUTPUT_FILE"

#┌───────────────┐
#│ Проект собран │
#└───────────────┘
echo '3/3 Проект собран!'
